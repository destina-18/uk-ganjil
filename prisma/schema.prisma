generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int        @id @default(autoincrement())
  username  String     @unique
  password  String
  role      UserRole
  mahasiswa Mahasiswa?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("users")
}

model Dosen {
  nidn          Int           @id
  nama_dosen    String        @db.VarChar(255)
  jenis_kelamin JenisKelamin
  alamat        String        @db.Text
  matakuliah    Matakuliah[]
  penjadwalan   Penjadwalan[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("dosen")
}

model Mahasiswa {
  nim                 String                @id @db.VarChar(50)
  nama_mahasiswa      String                @db.VarChar(255)
  jenis_kelamin       JenisKelamin
  jurusan             String                @db.VarChar(255)
  userId              Int                   @unique
  user                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  mahasiswaMatakuliah MahasiswaMatakuliah[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt

  @@map("mahasiswa")
}

model Matakuliah {
  id_matakuliah       Int                   @id
  nama_matakuliah     String                @db.VarChar(255)
  id_dosen            Int
  sks                 Int
  dosen               Dosen                 @relation(fields: [id_dosen], references: [nidn], onDelete: Restrict)
  penjadwalan         Penjadwalan?
  mahasiswaMatakuliah MahasiswaMatakuliah[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt

  @@map("matakuliah")
}

model Penjadwalan {
  id            Int        @id @default(autoincrement())
  id_dosen      Int
  id_matakuliah Int        @unique
  jadwal        String     @db.VarChar(255)
  dosen         Dosen      @relation(fields: [id_dosen], references: [nidn], onDelete: Restrict)
  matakuliah    Matakuliah @relation(fields: [id_matakuliah], references: [id_matakuliah], onDelete: Cascade)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@map("penjadwalan")
}

model MahasiswaMatakuliah {
  id            Int        @id @default(autoincrement())
  mahasiswa_nim String     @db.VarChar(50)
  id_matakuliah Int
  tahun_ajaran  String?    @db.VarChar(20)
  semester      Int?
  mahasiswa     Mahasiswa  @relation(fields: [mahasiswa_nim], references: [nim], onDelete: Cascade)
  matakuliah    Matakuliah @relation(fields: [id_matakuliah], references: [id_matakuliah], onDelete: Cascade)
  createdAt     DateTime   @default(now())

  @@unique([mahasiswa_nim, id_matakuliah])
  @@index([mahasiswa_nim])
  @@index([id_matakuliah])
  @@index([tahun_ajaran, semester])
  @@map("mahasiswa_matakuliah")
}

enum UserRole {
  ADMIN
  MAHASISWA
}

enum JenisKelamin {
  L
  P
}
